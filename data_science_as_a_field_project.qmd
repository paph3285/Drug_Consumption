---
title: "Data Science as a Field Project"
author: "Kate Borden, Evan McCormick, Paige Phillips"
date: "11/17/2022"
format: html
toc: true
editor: visual
page-layout: full
---

```{r Import Packages, include=FALSE}
library(tidyverse)
library(dplyr)
library(stringr)
library(arules)
library(arulesViz)
```

# **Statement of question and interest**

For our project we are interested in drug consumption and the association to personality and behavior. For instance, we want to further evaluate the different types of risk to be for each drug. We can split up the drugs based on how they are scheduled or classified in as controlled substances. \####[***TO BE CONTINUED***]{.underline}- include something about which drug(s) we are looking at -- we can compare based on drug class/schedule + drug usage + personality AND/OR based on educations level + drug usage + personality####

1.  Question: \*What factors in personality and prior drug use are predominantly associated with the use of specific drugs -- especially hard drugs?\*

## Source & Dataset Description

We got our database from here, see [Drug Consumptions (UCI)](https://www.kaggle.com/datasets/obeykhadija/drug-consumptions-uci)

You can access our data here, see [GitHub](https://github.com/paph3285/Drug_Consumption)

### **Contents of the Dataset:**

#### **Featured Attributes for Quantified Data**

-   *ID*: total number of 1885 records in this database

-   *Age*: participant's age

-   *Gender*: binary of only fale or female

-   *Education*: participant's level of education

-   *Country*: participant's country of origin

-   *Ethnicity*: participant's ethnicity

#### **Featured Attributes for Personality measurements (**NEO-FFI-R)

-   *Nscore*: neuroticism

-   *Escore*: extraversion

-   *Oscore*: openness to experience.

-   *Ascore*: agreeableness.

-   *Cscore*: conscientiousness.

-   *Impulsive*: impulsiveness (measured by BIS-11)

-   *SS*: sensation seeing (measured by ImpSS)

#### **Consumption usage of 18 legal and illegal drugs**

1.  *Alcohol*: alcohol consumption

2.  *Amphet*: amphetamines consumption

3.  *Amyl*: nitrite consumption

4.  *Benzos*: benzodiazepine consumption

5.  *Caff*: caffeine consumption

6.  *Cannabis*: marijuana consumption

7.  *Choc*: chocolate consumption

8.  *Coke*: cocaine consumption

9.  *Crack*: crack cocaine consumption

10. Ecstasy: ecstasy consumption

11. *Heroin*: heroin consumption

12. *Ketamine*: ketamine consumption

13. *Legalh*: legal highs consumption

14. *LSD*: LSD consumption

15. *Meth*: methadone consumption

16. *Mushroom*: magic mushroom consumption

17. *Nicotine*: nicotine consumption

18. *Semer*: class of fictitious drug Semeron consumption (i.e. control)

19. *VSA*: class of volatile substance abuse consumption

#### **Rating's for Drug Use**

-   CL0: Never Used

-   CL1: Used over a Decade Ago

-   CL2: Used in Last Decade

-   CL3: Used in Last Year 59

-   CL4: Used in Last Month

-   CL5: Used in Last Week

-   CL6: Used in Last Day

## Dataframe

```{r read in data, echo=FALSE, }
#| echo: false
# TODO - read in file directly from kaggle

df <- read.csv(url("https://raw.githubusercontent.com/paph3285/Drug_Consumption/main/Drug_Consumption.csv"))

```

```{r data, echo=FALSE, }

knitr::kable(
  head(df[0:32])
  )
```

### Subset dataframe

```{r Subset Dataframe, echo=FALSE}
#| echo: false\

Subset_Drugs <- df %>% select(-c("ID", "Ethnicity", "Country", "Education", "Age", "Gender", "Caff", "Choc", "Semer","Nscore","Escore","Oscore","AScore","Cscore","Impulsive","SS"))

head(Subset_Drugs)
```

### Examine Data

```{r Examine Data, echo=FALSE}
#| echo: false
# check for NAs

sum(is.na(df))

```

### Clean data

```{r Clean Data, echo=FALSE}
#| echo: false

categorical_columns = c('Alcohol', 'Amphet', 'Amyl', 'Benzos', 'Cannabis', 'Coke', 'Crack', 'Ecstasy', 'Heroin', 'Ketamine', 'Legalh', 'LSD', 'Meth', 'Mushrooms', 'Nicotine', 'VSA')

# TODO -Remove columns ID,Choc - chocolate consumption, Semer - class of fictitious drug Semeron consumption (i.e. control)

# We will drop overclaimers since, there answers might not truly be accurate

# We will also drop unnecesary columns

# convert drug columns to numericaL
for (col in categorical_columns) {
  Subset_Drugs[col] = as.numeric(gsub("CL", "", Subset_Drugs[, col]))
  
  # categorize drug column as either 'used' (1) or 'never used' (0)
  # if Drugs[col] == 0 (never used) or Drugs[col] == 1 (used over a decade ago), cateogorize them as a non-user
  Subset_Drugs[,col]=ifelse((Subset_Drugs[,col] == 0 | Subset_Drugs[,col] == 1), 0, 1)
}
```

```{r Combining Columns, echo=FALSE}
#| echo: false

# combine columns of similar drugs
# TODO - do we want to do this? How should we group them? 
# These should be extra columns to run analyses on in addition to the individual drugs.
Subset_Drugs <- Subset_Drugs %>%
  mutate(Psychedelics = pmax(LSD, Mushrooms), Sedatives = pmax(Alcohol, Benzos, Ketamine), Stimulants = pmax(Amphet,Coke,Crack,Ecstasy,Meth))
# Cannabis shouldn't be OTC, this survey was predominantly done in the UK, in which Marijuana remains a controlled substance. Illegal columns doesn't make any sense as most of these drugs are illegal to use recreationally. We should use the inverse of "OTC" instead.

# drop redudent columns
# TODO - drop all columns that have been combined. Don't do this, there's still many useful insights ot be had with the original columns.
```

## Using Frequency Pattern Analysis to find common patterns in drug use.

One pattern found in the data is that people's drug use tends to cluster around specific groups of drugs. Using Frequency Pattern (FP) analysis, popular drug groupings are found at various levels of popularity.

```{r Creating a Dataframe for FP, echo = FALSE}
All_Trans <- ( Subset_Drugs > 0 )
All_Trans <- as.data.frame( Subset_Drugs > 0)
Drug_Trans <- All_Trans %>% select(`Alcohol`:`VSA`)
No_OTC <- All_Trans %>% select(-c(`Alcohol`,`Nicotine`,`Cannabis`,`Psychedelics`,`Stimulants`,`Sedatives`))
Hard_Trans <- No_OTC %>% select(-c(`Ecstasy`,`Mushrooms`))
Class_Trans <- All_Trans %>% select(`Psychedelics`:`Stimulants`)

drug_rules <- apriori(Drug_Trans,list(
  support = 0.4,
  confidence = 0.9,
  minlen = 2
))

inspect(drug_rules)

```

When looking at all drug relations, the most common 'basket' of drugs used in combination is the three most common drugs used: Alcohol, Cannabis, and Nicotine. While these three are often used together, they are also found to be the main drug used in combination with other, less common drugs. This shows their status as "gateway" drugs. Nearly everyone who uses some of the harder, less common drugs also uses one of these three.

```{r FP rules for hard drugs (no alcohol, tobacco, weed, or general groupings)}
hard_drug_rules <- apriori(No_OTC,list(
 support = 0.18,
 confidence = 0.9,
 minlen = 2
))

inspect(hard_drug_rules)
```

When removing the three 'gateway' drugs from the market baskets, a new pattern emerges. Around 20% of drug users use a combination of drugs including Cocaine, Amphetamine, LSD, Mushrooms, Benzos and Ecstasy (MDMA). These drugs are a varied group, and could be considered "medium" drugs, although some of them, such as Amphetamines and Benzodiazapines, are as volatile as the 'harder' drugs included in this data table. Within this group of drugs, Psilocybin and Ecstasy appear to act as the "gateway".

```{r}

hard_rules <- apriori(Hard_Trans,list(
 support = 0.11,
 confidence = 0.9,
 minlen = 2
))

inspect(hard_rules)
```

Removing the secondary "gateway" drugs from the possible combinations gives a third set of rules, in which Benzodiazapines predict the use of other hard drugs such as Amphetamines, Methamphetamine, and Cocaine.

```{r drug class Rules}
class_rules <- apriori(Class_Trans,list(
 support = 0.4,
 confidence = 0.9,
 minlen = 2
))

inspect(class_rules)
```

### Visualize Correlation #1

```{r Graphing 1, echo=FALSE}
#| echo: false
# TODO - graph findings
plot(class)
```

### Visualize Correlation #2

```{r Graphing 2, echo=FALSE}
#| echo: false
# TODO - graph findings

```

## Conclusion

asdknflaslnksnfadnfkfllankldfnnvavlvnlnnvnldnvlnvslv

### Possible Biases:

##### 1. Kate's Bias -

sdnalsnsldnvslvn

##### 2. Evan's Bias-

sdnalsnsldnvslvn

##### 3. Paige's Bias -

Some personal biases that I can acknowledge from this project and dataset are the "Drugs" listed. Personally, I would not classify a handful of the options presented as drugs and would not have included them in the original dataset. Precisely alcohol, caffeine, chocolate, and possibly marijuana. One possible explanation to my bias, is due to how prevalent or not these specifics drugs are in my life. I am more likely to see family, friends, peers consume alcohol, caffeine, chocolate, and marijuana (depending on where you live) than lets say consume meth, heroin, or benzos, and so forth. Another possible explanation is that I am unfamiliar and unaware of anyone that has overdosed or become addicted. For those who have gone to rehab or know someone that has, they may view these drug categories very different than me. Lastly, the word "drug(s)" carries negative connotation behind it. More often than not my mind jumps to 1) illegal, 2) substance use disorder, 3) ruins lives. Again, a lot of these are associated with more illicits drugs like cocaine, meth, heroin, etc., not so much with alcohol, chocolate, caffeine, and marijuana. How I perceive these drugs is a bias of itself. If I were to not include some of these drugs in the dataset, would be unethical of me as a data scientist.

# SessionInfo

```{r ,echo=FALSE}
#| echo: false

sessionInfo()
```

